generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String         @id @default(uuid())
  email         String         @unique
  password      String
  name          String?
  subscriptions Subscription[]
  chatMessages  ChatMessage[]
  monthlyUsage  MonthlyUsage[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

model Subscription {
  id            String   @id @default(uuid())
  user          User     @relation(fields: [userId], references: [id])
  userId        String
  tier          Tier
  billingCycle  BillingCycle
  maxMessages   Int
  active        Boolean  @default(true)
  autoRenew     Boolean  @default(true)
  startDate     DateTime @default(now())
  endDate       DateTime
  renewalDate   DateTime
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model ChatMessage {
  id        String   @id @default(uuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  question  String
  answer    String
  tokens    Int
  createdAt DateTime @default(now())
}

model MonthlyUsage {
  id           String   @id @default(uuid())
  user         User     @relation(fields: [userId], references: [id])
  userId       String
  messagesUsed Int      @default(0)
  month        Int
  year         Int
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

enum Tier {
  BASIC
  PRO
  ENTERPRISE
}

enum BillingCycle {
  MONTHLY
  YEARLY
}
